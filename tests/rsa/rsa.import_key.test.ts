import { RSA } from "./../../rsa.ts";
import { assertEquals } from "https://deno.land/std@0.63.0/testing/asserts.ts";

Deno.test("RSA - Import JWK Public Key", () => {
  const jwk = {
    "e": "AQAB",
    "alg": "RS256",
    "use": "sig",
    "n":
      "7NfiTQcshWgrEdKbHC2e1s92kK-YX7jS3JLFIBpT8f_j_b5y3dQdtFFS4vBoVNQkwep_34x_ihYlhA3QkwaTL2XMSiedjLnubFZBUjs7G0dgGIR3F8A06Bf5KT4g2x1dKVb0Lwwqg22XIfqaS88HdU5pDwcVmq4pVMaJQgUK-xFEC_sHdfqTV8Z0uBCr9Nik_7xz68FINDYyLhehnvwph9ui-8_WeDgU_h5xrG8H7oY28y2NCtBwXxIadB-K8pHxK2srM8wTCIivdyZS80P0jZMqyxPkt4fO33-GQWvelVmR0bS4Arb3Y4bXnoAMCEao3DTm0bgeNVz39274ippJSQ",
    "kty": "RSA",
    "kid": "0a7dc12664590c957ffaebf7b6718297b864ba91",
  };

  const key = RSA.importKey(jwk);
  assertEquals(
    key.n,
    29898696334083768896266718702903171091859023056380305309417814312144807651236219776572988301924887627930068177446780412276940629516142064593112933354190594654697661829130606057587381851965706738909234655495626384372595795359236395774819608658749454999590004164863045288407450035910884781406353708688482649485901718330442366762092993760752462641504190676097552830866364434725980527790004239511223633036676476183317655075621501198026388523929916443949606011158134681907852424177605535928134115519418874993982126227290991413378693772648195647359413482755806577610702326142298069698977819919395238440777867763969032866121n,
  );
  assertEquals(key.e, 65537n);
  assertEquals(key.length, 256);
});

Deno.test("RSA - Import Certificate PEM", () => {
  const cert = `-----BEGIN CERTIFICATE-----
  MIIC8DCCAdgCAQMwDQYJKoZIhvcNAQELBQAwPDE6MDgGA1UEAwwxTXlTUUxfU2Vy
  dmVyXzUuNy4xN19BdXRvX0dlbmVyYXRlZF9DQV9DZXJ0aWZpY2F0ZTAeFw0yMDA2
  MDMwNzExMjBaFw0zMDA2MDEwNzExMjBaMEAxPjA8BgNVBAMMNU15U1FMX1NlcnZl
  cl81LjcuMTdfQXV0b19HZW5lcmF0ZWRfQ2xpZW50X0NlcnRpZmljYXRlMIIBIjAN
  BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtupn4nzv5elNq6+L8MzuSuUYmwCt
  EojEZ9vtv83DTQI24brXVk1/1ccOGe5hGGu4aTTpXU5LOb1V6v4robe0Vt3BuPsw
  GHZRt1LE/BQcuuZ0f/TCBafdEdLLpUP5TBUCVomKvZFxu+5P44bJW1d4iWsXUkyZ
  gO5TtF7x7PQvRVtsblaD4a8Et1qs58PNWN5AbOQw8GYokaSbkXDnP24ZTZbdNwu6
  W521oJuG9HFvIM6trGjoZR7N2NxJCUtq8OjTtmUqa5BVyTBJegp+pgLZEn/YDLag
  ll2Gx8xBOp0axxpzbc7P0JODCz21sh4ttyhyMMVjNPbn/vitgKpn0sdctQIDAQAB
  MA0GCSqGSIb3DQEBCwUAA4IBAQBbMXuLz2qZYqgZc/2CuD4w8E+sF4n1fWpdb9EP
  GWsHiyevEOF15YNkGlqQ8r4+h87TfL+SR4gw3PqfXEXuCkM3FuWvCulPTp/cFb7z
  T+EcNgGKuLbLpRdi0XpvyLtG9B5yi3nvhl8XHh31xFZ0WiTgwvdwUw/bQ+fKR6xQ
  8e0oj3SBjhcXmH5pmakFFeBjChIEPDkte5ImB6JwtwAlfvP/yTJEJxb9fUHEkR4A
  Q258orSdJ6gNn0XC7grCTpPYpMv2foIE0lPR1BryDD+M0QeBsLENlVNFEtnNLTcI
  UWFGFt5RctaF1ApP+inoTYapAQoDjTrOWcWYBJMkgKDk65Tg
  -----END CERTIFICATE-----`;

  const key = RSA.importKey(cert);
  assertEquals(key.e, 65537n);
  assertEquals(
    key.n,
    23090961311737573793101890708283924695433283000385054150823173852612673758230706931831331316346585281948637691806795052569468114184708524749728610979168598273283877538163829031755269185449374762314082288398270538054993384545276491531066649969558630423935152857250299602221281913410774031127740158653973996811337367884788028635132184093457045502358896056164012639638637637694971273993250785116955454220202034598919946428438516582026303702956399809398972276905876470428715345135826409789537975085486698172979761097583691702126455811212002371429452274581681294432992139097164326433615550289131259416635196384643694156981n,
  );
  assertEquals(key.length, 256);
});
